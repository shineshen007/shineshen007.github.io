---
layout: post
title: dockerè¸©å‘
tags: [Linux]
categories: [error]
---
------------------------------------------------------------------------


# å®‰è£…docker
Dockerå¼•æ“ï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰çš„å®‰è£…å¿…é¡»åœ¨rootæƒé™ä¸‹å®Œæˆï¼š
â€‹å®‰è£…ä¾èµ–ä¸æ ¸å¿ƒç»„ä»¶â€‹ï¼šéœ€é€šè¿‡sudoæ‰§è¡Œå®‰è£…å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š
```
sudo apt update
sudo apt install docker-ce docker-ce-cli containerd.io
```
â€‹æœåŠ¡å¯åŠ¨ä¸åˆå§‹åŒ–â€‹ï¼šå®‰è£…åéœ€å¯åŠ¨DockeræœåŠ¡ï¼š
```
sudo systemctl start docker  # å¯åŠ¨æœåŠ¡
sudo systemctl enable docker  # è®¾ç½®å¼€æœºè‡ªå¯[1,4](@ref)
```

# Docker å¯åŠ¨å¤±è´¥ä¸æ‹‰å–é•œåƒè¶…æ—¶é—®é¢˜è§£å†³è®°å½•

è®°å½•ä¸€æ¬¡åœ¨ Ubuntu ç¯å¢ƒä¸­ä½¿ç”¨ Docker æ—¶é‡åˆ°çš„é—®é¢˜ä¸è§£å†³è¿‡ç¨‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼š

- Docker æœåŠ¡å¯åŠ¨å¤±è´¥
- æ— æ³•æ‹‰å–é•œåƒï¼Œè¿æ¥ Docker Hub è¶…æ—¶

---

## é—®é¢˜ä¸€ï¼šDocker æœåŠ¡å¯åŠ¨å¤±è´¥

### ğŸ”§ é”™è¯¯ä¿¡æ¯

```bash
sudo systemctl start docker

Job for docker.service failed because the control process exited with error code.
See "systemctl status docker.service" and "journalctl -xeu docker.service" for details.

sudo systemctl status docker -l
Ã— docker.service - Docker Application Container Engine
    Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; preset: enabled)
    Active: failed (Result: exit-code)
    ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock
    ...
```
è§£å†³æ–¹æ¡ˆï¼šdaemon.json é…ç½®é”™è¯¯

æŸ¥çœ‹æ—¥å¿—ï¼š
```
sudo journalctl -xeu docker.service

æ²¡æœ‰ç»™å‡ºæ˜æ˜¾åŸå› ï¼Œäºæ˜¯å°è¯•æ‰‹åŠ¨å¯åŠ¨ Dockerï¼š

sudo /usr/bin/dockerd -D

è¾“å‡ºï¼š

unable to configure the Docker daemon with file /etc/docker/daemon.json: invalid character '/' looking for beginning of value

é—®é¢˜å®šä½ï¼š/etc/docker/daemon.json æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼Œå«æœ‰éæ³•å­—ç¬¦ï¼ˆå¦‚æ³¨é‡Š // ç­‰ï¼‰ã€‚
```
ä¿®å¤æ–¹å¼ï¼š

é‡å‘½åæˆ–åˆ é™¤é…ç½®æ–‡ä»¶ï¼š
```
sudo mv /etc/docker/daemon.json /etc/docker/daemon.json.bak

é‡æ–°å¯åŠ¨ Dockerï¼š

sudo systemctl restart docker

éªŒè¯æˆåŠŸå¯åŠ¨ï¼š

sudo systemctl status docker

```
â¸»

é—®é¢˜äºŒï¼šæ— æ³•æ‹‰å– Docker é•œåƒ

æŠ¥é”™ä¿¡æ¯ï¼š

docker pull hello-world
Error response from daemon: Get "https://registry-1.docker.io/v2/": context deadline exceeded

æˆ–ï¼š

net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)

è¯´æ˜ Docker æ— æ³•è¿æ¥ Docker Hubã€‚

ç½‘ç»œæµ‹è¯•ï¼š

curl -I https://registry-1.docker.io/v2/

ç»“æœï¼šè¿æ¥è¶…æ—¶ â†’ Docker Hub è¢«å¢™æˆ– DNS æ±¡æŸ“

â¸»

è§£å†³æ–¹æ¡ˆï¼šé…ç½®é•œåƒåŠ é€Ÿå™¨

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š
```
sudo mkdir -p /etc/docker
sudo nano /etc/docker/daemon.json
```
å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

{
  "registry-mirrors": [
    "https://docker.mirrors.ustc.edu.cn",
    "https://registry.docker-cn.com",
    "https://hub-mirror.c.163.com"
  ],
  "dns": ["8.8.8.8", "223.5.5.5"]
}

ä¿å­˜åï¼Œé‡å¯ Dockerï¼š
```
sudo systemctl daemon-reexec
sudo systemctl restart docker
```
å†æ¬¡æ‹‰å–é•œåƒæµ‹è¯•ï¼š
```
docker pull hello-world
```

â¸»

å¯é€‰ï¼šé…ç½®ä»£ç†ï¼ˆå¦‚ä½¿ç”¨ VPN æˆ– clashï¼‰

å¦‚æœéœ€è¦èµ°ä»£ç†ç½‘ç»œï¼ˆå¦‚åœ¨å…¬å¸æˆ–å®éªŒå®¤ï¼‰ï¼š

åˆ›å»ºæ–‡ä»¶ï¼š
```
sudo mkdir -p /etc/systemd/system/docker.service.d
sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf
```
å†™å…¥ä»£ç†é…ç½®ï¼š
```
[Service]
Environment="HTTP_PROXY=http://127.0.0.1:7890"
Environment="HTTPS_PROXY=http://127.0.0.1:7890"
Environment="NO_PROXY=localhost,127.0.0.1"
```
é‡å¯ Docker æœåŠ¡ï¼š
```
sudo systemctl daemon-reexec
sudo systemctl daemon-reload
sudo systemctl restart docker
```

â¸»

æ€»ç»“

é—®é¢˜	åŸå› 	è§£å†³æ–¹æ¡ˆ
Docker å¯åŠ¨å¤±è´¥	daemon.json æ ¼å¼é”™è¯¯	ä¿®å¤æˆ–ç§»é™¤é…ç½®æ–‡ä»¶
æ‹‰å–é•œåƒå¤±è´¥	Docker Hub è¢«å¢™ / DNS æ±¡æŸ“	é…ç½®å›½å†…é•œåƒåŠ é€Ÿå™¨ + DNS
é•¿æœŸå¤±è´¥	ç½‘ç»œå°é”ä¸¥é‡	ä½¿ç”¨ä»£ç†æˆ–ç¦»çº¿å¯¼å…¥

